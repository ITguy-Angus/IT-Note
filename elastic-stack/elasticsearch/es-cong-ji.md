# ES叢集

## 一、寫在前面

 ES（Elasticsearch下文統一稱為ES）越來越多的企業在業務場景是使用ES儲存自己的非結構化資料，例如電商業務實現商品站內搜尋，資料指標分析，日誌分析等，ES作為傳統關係型資料庫的補充，提供了關係型資料庫不具備的一些能力。

ES最先進入大眾視野的是其能夠實現全文搜尋的能力，也是由於基於Lucene的實現，內部有一種倒排索引的資料結構。

本文作者將介紹ES的分散式架構，以及ES的儲存索引機制，本文不會詳細介紹ES的API，會從整體架構層面進行分析，後續作者會有其他文章對ES的使用進行介紹。

## 二、什麼是倒排索引

要講明白什麼是倒排索引，首先我們先梳理下什麼索引，比如一本書，書的目錄頁，有章節，章節名稱，我們想看哪個章節，我們通過目錄頁，查到對應章節和頁碼，就能定位到具體的章節內容，通過目錄頁的章節名稱查到章節的頁碼，進而看到章節內容，這個過程就是一個索引的過程，那麼什麼是倒排索引呢？

比如查詢《java程式設計思想》這本書的文章，翻開書本可以看到目錄頁，記錄這個章節名字和章節地址頁碼，通過查詢章節名字“繼承”可以定位到“繼承”這篇章節的具體地址，檢視到文章的內容，我們可以看到文章內容中包含很多“物件”這個詞。

那麼如果我們要在這本書中查詢所有包含有“物件”這個詞的文章，那該怎麼辦呢？

按照現在的索引方式無疑大海撈針，假設我們有一個“物件”--→文章的對映關係，不就可以了嗎？類似這樣的反向建立對映關係的就叫倒排索引。

如圖1所示，將文章進行分詞後得到關鍵詞，在根據關鍵詞建立倒排索引，關鍵詞構建成一個詞典，詞典中存放著一個個詞條（關鍵詞），每個關鍵詞都有一個列表與其對應，這個列表就是倒排表，存放的是章節文件編號和詞頻等資訊，倒排列表中的每個元素就是一個倒排項，最後可以看到，整個倒排索引就像一本新華字典，所有單詞的倒排列表往往順序地儲存在磁碟的某個檔案裡，這個檔案被稱之為倒排檔案。

![](https://static001.geekbang.org/infoq/bb/bbbc78e45f794b4e51d68fae680c6c97.webp)

